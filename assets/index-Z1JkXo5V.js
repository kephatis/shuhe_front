import{d as g,u as f,r as w,a as _,o as N,c as v,b as n,w as p,v as u,E as t,e as b,f as x,_ as h}from"./index-BwvHQF3L.js";import{r as y}from"./axiosReq-COIr0NbK.js";import{m as I}from"./md5-Bzrn7Oyt.js";const k=l=>{const s=new FormData;return s.append("username",l.username),s.append("password",l.password),y({url:"/smartweb/api/auth/login",method:"post",data:s})},L={class:"login-container"},U={class:"login-form"},D={class:"form-group"},B={class:"form-group"},E=g({__name:"index",setup(l){const s=f(),i=b(),d=w(!1),a=_({loginName:s.getLoginName,password:""}),c=async()=>{if(!a.loginName||!a.password){t.warning("请输入用户名和密码");return}d.value=!0;try{console.log("start login ...");const r=I(a.password);console.log("password md5:",r);const o={username:a.loginName,password:r},e=await k(o);if(e.code===1){s.setLoginInfo(e.data),s.updateLoginName(a.loginName),s.updateUserName(e.data.userInfo.memberName),t.success("登录成功"),console.log("登录成功, token:",e.data.token),console.log("登录成功, userInfo:",e.data.userInfo);const m=e.data.userInfo?.roles||[];console.log("用户角色:",m),m.includes("admin")?i.push({name:"door_admin"}):i.push({name:"door_member"})}else t.error(e.message||"登录失败")}catch(r){console.error("login error:",r),t.error("登录请求失败")}finally{d.value=!1}};return N(()=>{s.isLogin&&console.log("用户已登录:",s.getUserName)}),(r,o)=>(x(),v("div",L,[n("div",U,[o[4]||(o[4]=n("h2",{class:"login-title"},"用户登录",-1)),n("div",D,[o[2]||(o[2]=n("label",{class:"form-label"},"用户名:",-1)),p(n("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=e=>a.loginName=e),class:"form-input",placeholder:"请输入用户名"},null,512),[[u,a.loginName]])]),n("div",B,[o[3]||(o[3]=n("label",{class:"form-label"},"密码:",-1)),p(n("input",{type:"password","onUpdate:modelValue":o[1]||(o[1]=e=>a.password=e),class:"form-input",placeholder:"请输入密码"},null,512),[[u,a.password]])]),n("button",{onClick:c,class:"login-btn"},"登录")])]))}}),R=h(E,[["__scopeId","data-v-117a8564"]]);export{R as default};
